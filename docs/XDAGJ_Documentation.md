#                                      XDAGJ功能大纲

## V1.0版本功能实现

### 必备功能

#### 一、基础组件

##### 1、网络发现（实现）

​	（1）矿池之间的网络采用dnet网络，存在白名单，矿池定时从远程服务器拉取最新的白名单地址，并且主动向白名单地址发起连接请求。握手协议采用的是发送预设的密钥，密钥验证通过后可以与白名单节点建立连接，进行数据的交互。

​	（2）普通用户之间不存在通信,普通用户只能作为矿工去连接白名单节点的矿池，矿工与矿池之间采用的只是简单的点对点连接。

##### 2、数据收发（实现）

​	（1）矿池和矿池之间的通信，实现区块的请求，sum的收发和验证，数据的同步

​	（2）矿工和矿池之间的通信，面向C版本矿工，可以接收到XDAJ发送的余额消息，任务消息，面向XDAGJ，可以接收到矿工反馈的任务计算结果并进行验证。

##### 3、数据存储（实现）

​	采用RocksDB作为底层数据库，目前有AccountStore数据库，保存的是账户数据，BlockStore区块数据库，保存的是主块，交易等区块数据

##### 4、密码库（实现）

​	为用户设置登录密码，密码验证

​	转账交易等风险操作暂未加入密码验证

#### 二、账本（基本实现）

##### 实现

​	转账功能已经实现，可以通过控制台命令进行转账

​	收集交易数据，BlockQueue会将矿池接收到的数据进行验证，并存放在队列中等待被链接。

​	采用基于账户的数据模型，区块的所有权归属于可解锁该区块的用户所有

##### 未实现

​	转账记录查询功能未实现（转账的明细暂时没有实现）

​	地址块的收入支出详情暂未实现打印

#### 三、共识（完成）

​	采用POW的共识算法，对区块进行双sha256计算，选取计算难度最大的随机数及矿工数据填充到区块中，并且该区块将会成为这一轮的主块，所有被主块连接的交易均被确认。

​	对于主块的奖励，采用延迟16个epoch的方式，对参与到挖矿的矿工按照计算出区块的难度占比进行分配，出块矿工额外奖励

#### 四、系统管理

##### 1、控制台命令（部分实现）

##### 实现部分

| 命令行               | 详解                                                         |
| -------------------- | ------------------------------------------------------------ |
| run                  | 启动                                                         |
| account [N]          | 打印指定数量的用户信息，默认20                               |
| balance [A]          | 打印指定地址的余额，若为空则打印当前用户余额                 |
| block [A]            | 打印区块的消息，A可以为区块hash或区块地址，暂未实现地址块的历史输入遍历 |
| mainblocks [N]       | 打印最新N个主块的信息，默认为20                              |
| minedblocks [N]      | 打印最新N个本节点挖出的主块，默认为20                        |
| keygen               | 生成新的ECkey（用于签名的密钥对）                            |
| net conn             | 显示当前连接的矿池信息                                       |
| net connect ip:port  | 连接新的矿池，                                               |
| xfer N A             | 转账功能的实现，将N个xdag转给地址为A的账户                   |
| miners               | 打印当前矿池连接的矿工的信息                                 |
| stats                | 打印当前全网状态，包括难度等信息                             |
| state                | 打印当前本节点的状态(例：“连接其他矿池中”；“已连接，同步区块中。。。”；) |
| disconnect O [A\|IP] | 断开所有的连接或者断开和某个矿工的连接                       |
| pool [CFG]           | 矿池的一些配置信息，包括奖励占比，允许接入的矿工等数量限制（目前是写死在配置类中） |

##### 未实现部分

| 命令行         | 详解                                                |
| -------------- | --------------------------------------------------- |
| mining [N]     | 开启N个线程进行挖矿（非必备功能）                   |
| lastblocks [N] | 打印最新N个区块的消息（和mainblocks类似，暂不实现） |

##### 2、日志系统（简易实现）

​	必要日志的保存和管理



### 非必备功能

#### 一、钱包（未实现）

​	目前只是实现了矿池对于密钥的存储，其他具体功能未开发

#### 二、智能合约与虚拟机（未实现）

​	引入wasm虚拟机，实现智能合约功能



## 备注

当前XDAGJ在只开启一个矿池的情况下不进行挖矿等工作，也不开启矿工连接服务，只有当两个矿池相互连接之后，才能正常运行。

-------



## V2.0 挖矿算法的改进

预计采用RandomX挖矿算法替换现有的双SHA256算法

为了尽可能减少普通用户和专业矿机之间的不平等关系，引入新算法，削弱专用挖矿设备对网络算力的影响，并对CPU挖矿进行优化，实现公平挖矿

-------



## V3.0 dnet网络的改进

目前版本所采用的dnet网络较为简陋，严格意义上来讲是一个半中心化的网络，后期将取消白名单机制，降低中心化程度。

预计采用KAD算法来优化现有网络或者采用libp2p替换现有dnet网络

